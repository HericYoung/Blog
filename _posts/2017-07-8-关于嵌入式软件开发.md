---
layout: post
title: 关于嵌入式软件开发
description: 自己所在专业的同级同学基本走的都是网页开发路线，也有少部分移动端，每次跟他们讲起嵌入式软件的时候，大部分人的反应都是一脸懵地看着你，这里简单讲下嵌入式软件究竟是个什么存在以及其开发流程。
category: Programming
tags: []
image: 
    feature: raspberry.jpg
---
&emsp;&emsp;首先，嵌入式软件也是软件，也是用代码堆出来的，但其一般只被应用在 ***嵌入式系统（Embedded system）中***。<br>
&emsp;&emsp;扯到嵌入式系统,首先讲下 ***通用计算机系统***，也就是我们平时接触的最多的个人计算机上运行的计算机系统，其能进行精确、快速的计算和判断,功能丰富，而且通用计算机性能好,使用容易，还能联成网络。技术方向是总线速度的无限提升，存储容量的无限扩大。<br>
&emsp;&emsp;嵌入式系统可以说就是通用计算机系统的一个对立面，它通常执行的是带有特定要求的预先定义的任务，大多数情况下需要设计人员为其进行各个方面的优化，比如减少体积，降低成本，使功耗尽量小等，与通用相对，它是一种 ***专用计算机系统***。<br>
&emsp;&emsp;还是举例子比较简单粗暴，其实嵌入式系统随处可见。我们平常使用的各种家用电器，空调，洗衣机，电饭煲等，其控制部分就是一个嵌入式系统，它只能实现帮你控制空调的开关，改变温度，改变工作模式，或者是改变洗衣机的工作模式，控制电饭煲的煮饭时间等等，你不能像使用个人电脑一样用它来玩游戏，听音乐，看电影，做开发等，它从被设计的时候就决定了它只能实现控制相关电器。嵌入式系统可以举的例子实在太多，基本身边的除去个人电脑以外的各种电子设备，内部都有一个嵌入式系统（但对于手机和平板电脑是否属于嵌入式系统还不能确定，因为从不同的角度有不同的判定和分析）。<br>
&emsp;&emsp;嵌入式系统的构架可以分成四个部分：处理器、存储器、输入输出（I/O）和软件。另外从系统组成上又有：<br>
#### 硬件层
&emsp;&emsp;与我们的个人电脑非常相似，包括：
 + 嵌入式微处理器(嵌入式系统的CPU)
 + 存储器，包含Cache(即CPU的缓存)，主存（相当于个人电脑的内存，嵌入式系统的主存现在一般使用Flash），辅助存储器（相当于个人计算机的硬盘）
 + 通用设备接口和I/O接口（如数模转换接口，以太网接口，串行通信接口，USB,音频视频输入输出，红外线接口等）

#### 中间层
&emsp;&emsp;嵌入式系统中硬件层与软件层的桥梁，也叫硬件抽象层或板级支持包，它将系统上层软件与底层硬件分离开来，使系统的底层驱动程序与硬件无关，上层软件开发人员无需关心底层硬件的具体情况，根据BSP 层提供的接口即可进行开发。该层一般包含相关底层硬件的初始化、数据的输入/输出操作和硬件设备的配置功能。<br>
&emsp;&emsp;实际上，BSP是一个介于操作系统和底层硬件之间的软件层次，包括了系统中大部分与硬件联系紧密的软件模块。设计一个完整的BSP需要完成两部分工作：嵌入式系统的硬件初始化以及BSP功能，设计硬件相关的设备驱动。

#### 软件层
##### 嵌入式操作系统
&emsp;&emsp;在嵌入式系统发展的初期，是使用单片机作为处理器（其实现在也还在广泛使用），单片机成本相当低，开发简单，记得当初自己学习单片机开发的时候购买的51系列单片机价格在2到3块，但是其系统只有8位，只有几百字节的RAM(内存)，几K的ROM（存放程序代码），根本无法搭载一个操作系统，只能执行一些单线程的程序（裸机）。<br>
&emsp;&emsp;随着嵌入式微处理器和嵌入式技术的发展，80年代开始程序员开始使用商业级的操作系统编写嵌入式系统软件。<br>
&emsp;&emsp;特别是现在统治移动设备处理器界的ARM处理器，其性能对于嵌入式系统来说已经非常强悍，如目前最新一代树莓派Raspberry Pi 3b使用的处理器就是基于ARM Cortex-A53架构，其为4核，64位的1.2GHz的处理器。<br>
&emsp;&emsp;目前在嵌入式领域广泛使用的操作系统有：嵌入式实时操作系统µC/OS-II、嵌入式Linux、Windows Embedded、VxWorks等，以及应用在智能手机和平板电脑的Android、iOS等。<br>
##### 设备驱动程序
 &emsp;&emsp;在系统中驱动程序起着让用户与硬件交流的关键作用，驱动程序存在于系统内核中，有相当高的工作权限，能够控制处理器的引脚的工作模式，电平，数据传输等，并向用户提供屏蔽底层实现的操作接口，以嵌入式Linux系统为例，由于Linux的核心思想为 **“一切皆文件”**，在驱动程序中也是将某一个具体的设备封装为设备文件的形式，如一个LED灯，驱动程序中有具体的底层操作（控制电路打开关闭LED）等，向上层就提供几个文件操作函数，使用fopen打开LED的设备文件，使用fwrite项文件写入1就打开LED，写入0就关闭LED等（只是其中一种实现方式，可根据自己需要编写相应的驱动程序）。<br>
##### 应用程序
&emsp;&emsp;应用程序就是根据需求，利用各种设备操作接口，开发一套功能完整程序，如一个简单的灯光自动调节程序，程序能够实时监听系统上光线传感器的数据，等周围光线较暗的时候就去打开LED，反之则关闭LED。<br>

#### 开发流程
&emsp;&emsp;开发工作的编码部分还是要在个人电脑上完成的，因为一般嵌入式系统不具备开发条件。<br>
&emsp;&emsp;像单片机或其他芯片使用裸机状态（无系统）开发时，一般都是写C语言代码，编译好之后下载到芯片里，通电运行就可以了，但对于像ARM处理器这种，并且有搭载嵌入式系统，就要使用 ***“交叉编译”***这种特殊的开发流程了，原因是我们平时使用的个人电脑一般为x86架构，而ARM处理器使用的ARM架构，使用x86架构上的编译器编译出的程序只能在x86架构的机器上跑，同理，ARM架构也是，所以，在程序代码编写完之后我们需要使用ARM编译器（在x86架构的个人电脑上也是可以安装和运行ARM编译器的）对程序进行编译，得到一个可运行文件之后将其下载到嵌入式系统中，然后在嵌入式系统中执行该程序。<br>
&emsp;&emsp;另外，当因为程序需要在嵌入式系统中安装服务器软件（如Apache），数据库（Sqlite）时，我们也需要在个人电脑中从网上下载这些软件的源代码，然后使用ARM编译器编译出的ARM架构的版本，才能放到嵌入式系统中运行。<br>

* * *  
&emsp;&emsp;跟纯软件的开发相比，嵌入式的软件开发包含了硬件部分，有个能摸得着的东西，而且可以根据需要自己购买不同传感器或其他功能模块各种DIY，乐趣还是相当多的。这里有一篇可以勾起你兴趣的文章：<br>
&emsp;&emsp;[34 个使用 Raspberry Pi 的酷创意](https://linuxtoy.org/archives/cool-ideas-for-raspberry-pi.html)<br><br>
&emsp;&emsp;当初入了嵌入式的坑完全是因为：![Tony Stark]({{ site.url }}/images/20170708/stark.jpg)<br>
&emsp;&emsp;钢铁侠应该是嵌入式领域的最杰出作品了。

 




